(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{433:function(s,n,a){"use strict";a.r(n);var e=a(42),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"关于this"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关于this"}},[s._v("#")]),s._v(" 关于this")]),s._v(" "),a("p",[s._v("以前看某本书上讲：")]),s._v(" "),a("blockquote",[a("p",[s._v("掌握了JS中this的用法才算真正的跨过 了JS的门槛 我深以为是！")])]),s._v(" "),a("p",[s._v("但是JS的this却并不是那么简单的内容，许多同学都很困惑，也肯定有同学像我曾经一样查阅各种资料想知")]),s._v(" "),a("p",[s._v("道"),a("code",[s._v("How to understand this of javascript")]),s._v("。很幸运的是，网上有非常非常多的文章关于"),a("code",[s._v("this")]),s._v("的，简")]),s._v(" "),a("p",[s._v("直就是琳琅满目…曾经，我看到某些文章非常开心，因为他们讲得确实非常好，以至于我确信我已掌握了")]),s._v(" "),a("p",[s._v("this的用法。然而可能是由于我太笨了，经常过一段时间就忘得一干二净了，这真的是一件很尴尬的事情……")]),s._v(" "),a("p",[s._v("直到后来我仔细地琢磨又琢磨，终于感觉我可能以后不会再忘记了。所以想把我琢磨的内容和大家分享一下")]),s._v(" "),a("p",[s._v("说到this，就不得不提到function，相信看过其它类似文章的同学也知道，正是由于调用function的对象不")]),s._v(" "),a("p",[s._v("同，才导致了this的指向不同。所以以前老是去记忆每种调用function的情况所对应的this，因为情况有限而")]),s._v(" "),a("p",[s._v("且很少，所以这当然是可行的——对于聪明人来说。所以我不得不思考另外一些方式来让我记住。")]),s._v(" "),a("p",[s._v("那么首先我们需要明确的一个事情是：function也是对象")]),s._v(" "),a("p",[s._v("同时我们还需要明确的一个事情是：function执行时是在某个特定的上下文中执行的。那什么是上下文呢？")]),s._v(" "),a("p",[s._v("打个比方，比如你练会了辟邪剑谱，那这时候你的掌门让你用辟邪剑谱砍人。如果仅仅是这样的话，你是没")]),s._v(" "),a("p",[s._v("法完成这个任务的，因为你必须得知道要砍谁吧，其次去哪儿砍吧，那么是个地下通道还是一望无尽的大草")]),s._v(" "),a("p",[s._v("原，要是地下通道你走路都困难，还怎么用辟邪剑谱呢对吧。这就是上下文，函数执行时它也需要一些额外")]),s._v(" "),a("p",[s._v("的信息来支撑它的运行。那么既然function是对象的话，就会有方法。而function中最核心的方法是call方")]),s._v(" "),a("p",[s._v("法。因此我们就从这儿入手。")]),s._v(" "),a("h2",{attrs:{id:"call方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#call方法"}},[s._v("#")]),s._v(" call方法")]),s._v(" "),a("p",[s._v("先来看一下如何使用call方法:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('function say(content) { console.log("From " + this + ": Hello "+ content); } \nsay.call("Bob", "World"); //==> From Bob: Hello World \n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("接下来仔细分析一下call的用法：")]),s._v(" "),a("ul",[a("li",[s._v("Step1: 把第二个到最后一个参数作为函数执行时要传入的参数")]),s._v(" "),a("li",[s._v("Step2: 把函数执行时的this指向第一个参数")]),s._v(" "),a("li",[s._v('Step3: 在上面这个特殊的上下文中执行函数\n上面例子中，我们通过call方法，让say函数执行时的this指向"Bob"，然后把"World"作为参数传进去，所以输出结果是可以预见的。')])]),s._v(" "),a("h4",{attrs:{id:"js执行函数时会默认完成以上的步骤，你可以把直接调用函数理解为一种语法糖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#js执行函数时会默认完成以上的步骤，你可以把直接调用函数理解为一种语法糖"}},[s._v("#")]),s._v(" js执行函数时会默认完成以上的步骤，你可以把直接调用函数理解为一种语法糖")]),s._v(" "),a("p",[s._v("比如")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('function say(word) { console.log(world); } \nsay("Hello world"); say.call(window, "Hello world"); \n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v('以上可以把say("Hello world")看做是say.call(window,"Hello world")的语法糖。')]),s._v(" "),a("p",[s._v("这个结论非常关键 所以以后每次看见functionName(xxx)的时候，你需要马上在脑海中把它替换为")]),s._v(" "),a("p",[s._v("functionName.call(window,xxxx)，这对你理解this的指向非常重要。不过也有例外，在ES5的strict mode")]),s._v(" "),a("p",[s._v("中call的第一个参数不是window而是undefined。之后的例子我假设总是不在strictmode下，但你需要记住")]),s._v(" "),a("p",[s._v("strictmode有一点儿不同。 对于匿名函数来说，上面的结论也是成立的")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(' (function(name) { // })("aa"); //等价于 (function(name) { // }).call(window, "aa");\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("函数作为对象的方法被调用")]),s._v(" "),a("p",[s._v("直接来看代码：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('var person = { \nname : "caibirdme", \nrun : function(time) { \nconsole.log(this.name + "has been running for over "+ time+ " minutes"); \n} }; \nperson.run(30); //==> caibirdme has been running for over 30 minutes //等价于 person.run.call(person, 30); // the same \n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("你会发现这里call的第一个参数是person而不是window。")]),s._v(" "),a("p",[s._v("当你明白了这两点，下意识地把函数调用翻译成foo.call()的形式，明确call的第一个参数，那基本上this的问")]),s._v(" "),a("p",[s._v("题就难不住你了。")]),s._v(" "),a("p",[s._v("还是来举几个例子吧")]),s._v(" "),a("p",[s._v("例一：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('function hello(thing) { \nconsole.log(this + " says hello " + thing); \n} \nperson = { name: "caibirdme" } \nperson.hello = hello; \nperson.hello("world") // 相当于执行 person.hello.call(person, "world") //caibirdme says hello world hello("world") // 相当于执行 hello.call(window, "world") //[object DOMWindow]world\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("例二：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var obj = {\n x: 20,\n f: function(){ \nconsole.log(this.x);\n } }; \nobj.f(); // obj.f.call(obj) //==> 20 \nobj.innerobj = {\n x: 30, \nf: function(){ \nconsole.log(this.x); \n} } \nobj.innerobj.f(); // obj.innerobj.f.call(obj.innerobj) // ==> 30 \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("例三：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var x = 10; \nvar obj = { \nx: 20, f: function(){ \nconsole.log(this.x); //this equals obj // ==> 20 \nvar foo = function(){ \nconsole.log(this.x); \n} \nfoo(); // foo.call(window) //foo中this被指定为window，所以==> 10 } }; obj.f(); // obj.f.call(obj) // ==> 20 10 \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("由例三引出一个非常common的问题，如果我想让foo输出20怎么办？这时候需要用到一点小技巧")]),s._v(" "),a("p",[s._v("例四：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var x = 10; \nvar obj = { \nx: 20, \nf: function(){ \nconsole.log(this.x); \nvar that = this; //使用that保留当前函数执行上下文的this \nvar foo = function(){ console.log(that.x); } //此时foo函数中的this仍然指向window，但我们使用that取得obj foo(); // foo.call(window) } }; \nobj.f(); \nobj.f.call(obj) // ==> 20 20 \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("再来一个稍微难一点点的(但其实用call替换法一点儿也不难)")]),s._v(" "),a("p",[s._v("例五：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var x = 10; \nvar obj = { \nx: 20,\nf: function(){ \nconsole.log(this.x); \n} }; \nobj.f(); // obj.f.call(obj) // ==> 20 \nvar fOut = obj.f;\n fOut(); // fOut.call(window) //==> 10 \nvar obj2 = { x: 30, f: obj.f } obj2.f(); // obj2.f.call(obj2) //==> 30 \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("例五有些同学会可能出错的原因，是没有明确我上面说的：")]),s._v(" "),a("h6",{attrs:{id:"this是在执行是才会被确认的"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#this是在执行是才会被确认的"}},[s._v("#")]),s._v(" this是在执行是才会被确认的")]),s._v(" "),a("p",[s._v("他可能会认为说obj.f那个函数定义在obj里面，那this就该指向obj。如果看完这篇文章你还这么想的话，我")]),s._v(" "),a("p",[s._v("会觉得我的表达水平太失败了…… 用于构造函数 先看一段代码：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(' func person(name) { this.name = name; } \nvar caibirdme = new person("deen"); // caibirdme.name == deen\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("我上面也说了，函数在用作构造函数时同样可以用call方法去代替，那这里怎么代替呢？")]),s._v(" "),a("p",[s._v("这里你又需要明确一点：")]),s._v(" "),a("h6",{attrs:{id:"new-constrcut-是一种创建对象的语法糖-它等价于"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#new-constrcut-是一种创建对象的语法糖-它等价于"}},[s._v("#")]),s._v(" "),a("code",[s._v("new constrcut()")]),s._v("是一种创建对象的语法糖 它等价于")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('function person(name) { this.name = name; } \nvar foo = new person("deen"); //通过new创建了一个对象 //new是一种语法糖，new person等价于 var bar = (function(name) { var _newObj = { constructor : person, __proto__ : person.prototype, };\n _newObj.constructor(name); // _newObj.constructor.call(_newObj, name) return _newObj; })(); \n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("So you can see……为什么new的时候this就指向新的对象了吧？")]),s._v(" "),a("p",[s._v("通过我这篇文章，我希望学会通过把一个函数调用替换成funcName.call的形式，从而理解运行时上下文中")]),s._v(" "),a("p",[s._v("this到底指向谁。")]),s._v(" "),a("p",[s._v("总结来说就是下面两个等价变形：")]),s._v(" "),a("ul",[a("li",[s._v("foo() ---\x3e foo.call(window)")]),s._v(" "),a("li",[s._v("obj.foo() --\x3e obj.foo.call(obj) 只要理解以上两个变形，this就不再是问题啦")])])])}),[],!1,null,null,null);n.default=t.exports}}]);